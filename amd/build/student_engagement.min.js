define ("local_ace/student_engagement",["exports","core/ajax","core/str","core/modal_factory","core/templates","core/modal_events","core/chart_builder","core/chart_output_chartjs","local_ace/chart_filters"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=j(b);d=j(d);e=j(e);f=j(f);g=j(g);h=j(h);function j(a){return a&&a.__esModule?a:{default:a}}var k={},l="average-course-engagement",m=null,n=null,o=!1,p=[];a.init=function init(a){k=a.userid;p=a.colours;(0,i.init)(t);var b=new URLSearchParams(new URL(window.location.href).search);if(b.has("course")){if(0===parseInt(b.get("course"))){document.querySelector("#show-courses-buttons").style.display=null}}else{document.querySelector("#show-courses-buttons").style.display=null}var c=document.querySelector("#chart-comparison");c.addEventListener("click",s);x().then(function(a){if(a.error){u(a.error);return}if(null!==a.preferences[0].value){l=a.preferences[0].value}t()}).catch(Notification.exception);document.querySelector("#show-all-courses").addEventListener("click",q);document.querySelector("#show-your-course").addEventListener("click",r)};var q=function(){document.querySelector("#show-all-courses").style.display="none";document.querySelector("#show-your-course").style.display=null;o=!0;document.querySelector("#student-engagement-legend").style.display="none";t()},r=function(){document.querySelector("#show-your-course").style.display="none";document.querySelector("#show-all-courses").style.display=null;document.querySelector("#student-engagement-legend").style.display=null;o=!1;t()},s=function(){var a=d.default.create({type:d.default.types.SAVE_CANCEL});a.then(function(a){a.getRoot()[0].classList.add("chart-comparison-modal");a.setTitle("Change course comparison data");var b=e.default.render("local_ace/chart_comparison_body",{});a.setBody(b);a.setSaveButtonText("Filter");a.getRoot().on(f.default.bodyRendered,function(){document.querySelector("#comparison-"+l).checked=!0;if(o){var a=document.querySelectorAll("input[name=\"comparison-options\"]");a.forEach(function(a){a.disabled=!0})}});a.getRoot().on(f.default.save,function(){var a=document.querySelector("input[name=\"comparison-options\"]:checked");if(null!==a){l=a.value}else{l="none"}t();w()});a.getRoot().on(f.default.hidden,function(){a.destroy()});a.show();return a}).fail(Notification.exception)},t=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:m,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:n;if(m!==a){m=a}if(n!==b){n=b}var d=new URL(window.location.href),e=new URLSearchParams(d.search),f=null;if(e.has("course")){f=parseInt(e.get("course"))}var i=v(f,k,m,n).then(function(a){if(null!==a.error){u(a.error);return null}else if(0===a.data.length){(0,c.get_string)("noanalytics","local_ace").then(function(a){u(a)}).catch();return null}var b=y();b.legend_options.display=o;var d=0;a.data.forEach(function(a){var c=z();c.label=a.label;c.values=a.values;if(o||a.colour===void 0){c.colors=[p[d%p.length]];d++}else{c.colors=[a.colour]}c.fill=a.fill?1:null;b.series.push(c)});b.labels=a.xlabels;b.axes.y[0].max=100;b.axes.y[0].stepSize=25;var e={};a.ylabels.forEach(function(a){e[a.value]=a.label});b.axes.y[0].labels=e;return b}).catch(function(){u("API returned an error")});i.then(function(a){if(null===a){return}var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML="";g.default.make(a).then(function(a){new h.default(c,a)}).catch()}).catch()},u=function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML=a},v=function(a,c,d,e){var f=4<arguments.length&&arguments[4]!==void 0?arguments[4]:l;return b.default.call([{methodname:"local_ace_get_user_analytics_graph",args:{courseid:a,userid:c,start:d,end:e,comparison:f,showallcourses:o}}])[0]},w=function(){var a={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"local_ace_comparison_method",value:l}]}};b.default.call([a])[0].fail(Notification.exception)},x=function(){return b.default.call([{methodname:"core_user_get_user_preferences",args:{name:"local_ace_comparison_method"}}])[0]},y=function(){return{type:"line",series:[],labels:null,title:null,axes:{x:[],y:[{label:null,labels:{},max:null,min:0,position:null,stepSize:null}]},legend_options:{display:!1},config_colorset:null,smooth:!0}},z=function(){return{label:"",labels:null,type:null,values:[],colors:[],fill:null,axes:{x:null,y:null},urls:[],smooth:null}}});
//# sourceMappingURL=student_engagement.min.js.map
