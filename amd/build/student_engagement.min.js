define ("local_ace/student_engagement",["exports","core/ajax","core/str","core/modal_factory","core/templates","core/modal_events","core/chart_builder","core/chart_output_chartjs","local_ace/chart_filters"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=j(b);d=j(d);e=j(e);f=j(f);g=j(g);h=j(h);function j(a){return a&&a.__esModule?a:{default:a}}var k,l={},m="average-course-engagement",n=null,o=null;a.init=function init(a){k=a.colouruserhistory;l=a.userid;(0,i.init)(p);p();var b=document.querySelector("#chart-comparison");b.addEventListener("click",function(){var a=d.default.create({type:d.default.types.SAVE_CANCEL});a.then(function(a){a.getRoot()[0].classList.add("chart-comparison-modal");a.setTitle("Change course comparison data");var b=e.default.render("local_ace/chart_comparison_body",{});a.setBody(b);a.setSaveButtonText("Filter");a.getRoot().on(f.default.bodyRendered,function(){document.querySelector("#comparison-"+m).checked=!0});a.getRoot().on(f.default.save,function(){var a=document.querySelector("input[name=\"comparison-options\"]:checked");if(null!==a){m=a.value}else{m="none"}p()});a.getRoot().on(f.default.hidden,function(){a.destroy()});a.show();return a}).fail(Notification.exception)})};var p=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:n,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:o;if(n!==a){n=a}if(o!==b){o=b}var d=new URL(window.location.href),e=new URLSearchParams(d.search),f=null;if(e.has("course")){f=parseInt(e.get("course"))}var i=r(f,l,n,o).then(function(a){if(null!==a.error){q(a.error);return null}else if(0===a.series.length){(0,c.get_string)("noanalytics","local_ace").then(function(a){q(a)}).catch();return null}var b=s();b.series[0].values=a.series;a.comparison.forEach(function(a){var c=t();c.label=a.label;c.colors=[a.colour];c.values=a.values;c.fill=a.fill?1:null;b.series.push(c)});b.labels=a.labels;b.axes.y[0].max=a.max;b.axes.y[0].stepSize=a.stepsize;var d={};a.ylabels.forEach(function(a){d[a.value]=a.label});b.axes.y[0].labels=d;return b}).catch(function(){q("API returned an error")});i.then(function(a){if(null===a){return}var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML="";g.default.make(a).then(function(a){new h.default(c,a)}).catch()}).catch()},q=function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML=a},r=function(a,c,d,e){var f=4<arguments.length&&arguments[4]!==void 0?arguments[4]:m;return b.default.call([{methodname:"local_ace_get_user_analytics_graph",args:{courseid:a,userid:c,start:d,end:e,comparison:f}}])[0]},s=function(){return{type:"line",series:[{label:"Your engagement",labels:null,type:null,values:null,colors:[k],fill:null,axes:{x:null,y:null},urls:[],smooth:null}],labels:null,title:null,axes:{x:[],y:[{label:null,labels:{},max:null,min:0,position:null,stepSize:null}]},legend_options:{display:!1},config_colorset:null,smooth:!0}},t=function(){return{label:"",labels:null,type:null,values:[],colors:[],fill:null,axes:{x:null,y:null},urls:[],smooth:null}}});
//# sourceMappingURL=student_engagement.min.js.map
