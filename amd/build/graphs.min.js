define ("local_ace/graphs",["exports","core/ajax","core/str","core/chart_builder","core/chart_output_chartjs"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=f(b);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}var g={chartFilterOptions:"#chart-filter-options",courseToDate:"#course-to-date",last12Days:"#last-12-days",startDate:"#start-date"};a.init=function init(){var a=l();if(null===a){a=document.querySelector(g.courseToDate);i(a)}j();h()};var h=function(a){a=isNaN(a)?null:a;var b=new URL(window.location.href),f=new URLSearchParams(b.search),g=parseInt(f.get("id")),h=null;if(f.has("course")){h=parseInt(f.get("course"))}o(h,g,a).then(function(a){var b=document.querySelector("#chart-area-engagement"),f=b.querySelector(".chart-image");f.innerHTML="";if(null!==a.error){n(a.error);return}else if(0===a.series.length){(0,c.get_string)("noanalytics","local_ace").then(function(a){n(a)});return}var g=p();g.series[0].values=a.series;g.series[1].values=a.average1;g.series[2].values=a.average2;g.labels=a.labels;d.default.make(g).then(function(a){new e.default(f,a)})}).catch(function(){n("API returned an error")})},i=function(a){m().forEach(function(b){if(b===a){b.dataset.filter="active"}else{b.dataset.filter=null}k()})},j=function(){m().forEach(function(a){if("date"===a.type){a.addEventListener("change",function(){i(a);var b=new Date(a.value).getTime()/1e3;b=b.toFixed(0);if(isNaN(b)){b=null}h(b)})}else{a.addEventListener("click",function(){i(a);var b=g.last12Days.substr(1,g.last12Days.length);if(a.id===b){var c=new Date;c.setDate(c.getDate()-12);var d=c.getTime()/1e3;h(d.toFixed(0))}else{h(null)}})}})},k=function(){var a=m();a.forEach(function(a){if(a.dataset.filter==="active"){if("date"===a.type){a.classList.add("border-primary")}else{a.classList.add("btn-primary");a.classList.remove("btn-secondary")}}else{a.classList.add("btn-secondary");a.classList.remove("border-primary");a.classList.remove("btn-primary")}})},l=function(){var a=m(),b=a.find(function(a){return a.dataset.filter==="active"});if(b!==void 0){return b}return null},m=function(){var a=document.querySelector(g.chartFilterOptions);return[a.querySelector(g.courseToDate),a.querySelector(g.last12Days),a.querySelector(g.startDate)]},n=function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML=a},o=function(a,c,d){return b.default.call([{methodname:"local_ace_get_user_analytics_graph",args:{courseid:a,userid:c,start:d}}])[0]},p=function(){return{type:"line",series:[{label:" Your engagement",labels:null,type:null,values:null,colors:["#5cb85c"],fill:null,axes:{x:null,y:null},urls:[],smooth:null},{label:"Average course engagement",labels:null,type:null,values:null,colors:["#CEE9CE"],fill:null,axes:{x:null,y:null},urls:[],smooth:null},{label:"Average course engagement",labels:null,type:null,values:null,colors:["#CEE9CE"],fill:1,axes:{x:null,y:null},urls:[],smooth:null}],labels:null,title:null,axes:{x:[],y:[{label:null,labels:{0:"Low",50:"Medium",100:"High"},max:100,min:0,position:null,stepSize:50}]},legend_options:{display:!1},config_colorset:null,smooth:!0}}});
//# sourceMappingURL=graphs.min.js.map
