define ("local_ace/graphs",["exports","core/ajax","core/str","core/chart_builder","core/chart_output_chartjs","local_ace/litepicker"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=g(b);d=g(d);e=g(e);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}var h={chartFilterOptions:"#chart-filter-options",courseToDate:"#course-to-date",last12Days:"#last-12-days",dateRange:"#date-range"};a.init=function init(){var a=m();if(null===a){a=document.querySelector(h.courseToDate);j(a)}k();i(null,null)};var i=function(a,b){var f=new URL(window.location.href),g=new URLSearchParams(f.search),h=parseInt(g.get("id")),i=null;if(g.has("course")){i=parseInt(g.get("course"))}var j=p(i,h,a,b).then(function(a){if(null!==a.error){o(a.error);return null}else if(0===a.series.length){(0,c.get_string)("noanalytics","local_ace").then(function(a){o(a)}).catch();return null}var b=q();b.series[0].values=a.series;b.series[1].values=a.average1;b.series[2].values=a.average2;b.labels=a.labels;b.axes.y[0].max=a.max;b.axes.y[0].stepSize=a.stepsize;var d={};a.ylabels.forEach(function(a){d[a.value]=a.label});b.axes.y[0].labels=d;return b}).catch(function(){o("API returned an error")});j.then(function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML="";d.default.make(a).then(function(a){new e.default(c,a)}).catch()}).catch()},j=function(a){n().forEach(function(b){if(b===a){b.dataset.filter="active"}else{b.dataset.filter=null}l()})},k=function(){var a=document.querySelector(h.chartFilterOptions),b=a.querySelector(h.courseToDate);b.addEventListener("click",function(){j(b);i(null,null)});var c=a.querySelector(h.last12Days);c.addEventListener("click",function(){j(c);var a=new Date;a.setDate(a.getDate()-12);var b=a.getTime()/1e3;i(b.toFixed(0),null)});var d=a.querySelector(h.dateRange),e=new f.default({element:d,singleMode:!1,splitView:!1,setup:function setup(a){a.on("selected",function(a,b){if(a===void 0||b===void 0){return}j(d);i(a.timestamp()/1e3,b.timestamp()/1e3)})}});e.clearSelection()},l=function(){var a=n();a.forEach(function(a){if(a.dataset.filter==="active"){a.classList.add("btn-primary");a.classList.remove("btn-secondary")}else{a.classList.add("btn-secondary");a.classList.remove("btn-primary")}})},m=function(){var a=n(),b=a.find(function(a){return a.dataset.filter==="active"});if(b!==void 0){return b}return null},n=function(){var a=document.querySelector(h.chartFilterOptions);return[a.querySelector(h.courseToDate),a.querySelector(h.last12Days),a.querySelector(h.dateRange)]},o=function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML=a},p=function(a,c,d,e){return b.default.call([{methodname:"local_ace_get_user_analytics_graph",args:{courseid:a,userid:c,start:d,end:e}}])[0]},q=function(){return{type:"line",series:[{label:" Your engagement",labels:null,type:null,values:null,colors:["#5cb85c"],fill:null,axes:{x:null,y:null},urls:[],smooth:null},{label:"Average course engagement",labels:null,type:null,values:null,colors:["#CEE9CE"],fill:null,axes:{x:null,y:null},urls:[],smooth:null},{label:"Average course engagement",labels:null,type:null,values:null,colors:["#CEE9CE"],fill:1,axes:{x:null,y:null},urls:[],smooth:null}],labels:null,title:null,axes:{x:[],y:[{label:null,labels:{},max:null,min:0,position:null,stepSize:null}]},legend_options:{display:!1},config_colorset:null,smooth:!0}}});
//# sourceMappingURL=graphs.min.js.map
