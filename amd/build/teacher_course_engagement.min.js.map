{"version":3,"sources":["../src/teacher_course_engagement.js"],"names":["COURSE_COLOUR_MATCH","init","updateGraph","startDate","endDate","engagementData","getTeacherCourseEngagementData","then","response","error","series","length","displayError","data","getGraphDataPlaceholder","forEach","title","parseInt","Math","random","toString","seriesData","getSeriesPlaceholder","label","values","colors","push","labels","xlabels","axes","y","max","stepSize","yLabels","ylabels","element","value","catch","chartArea","document","querySelector","chartImage","innerHTML","ChartBuilder","make","chart","ChartJSOutput","langString","start","end","Ajax","call","methodname","args"],"mappings":"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","sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Shows the teacher course engagement graph\n *\n * @module      local_ace/teacher_course_engagement\n * @copyright   2021 University of Canterbury\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport ChartBuilder from 'core/chart_builder';\nimport ChartJSOutput from 'core/chart_output_chartjs';\nimport {init as filtersInit} from 'local_ace/chart_filters';\n\nlet COURSE_COLOUR_MATCH = [];\n\nexport const init = () => {\n    filtersInit(updateGraph);\n    updateGraph(null, null);\n};\n\nconst updateGraph = (startDate, endDate) => {\n    let engagementData = getTeacherCourseEngagementData(startDate, endDate).then((response) => {\n        if (response.error !== null || response.series.length === 0) {\n            displayError(response.error);\n            return null;\n        }\n        let data = getGraphDataPlaceholder();\n        response.series.forEach((series) => {\n            // Store colours against courses so when switching history they stay the same colour.\n            if (!COURSE_COLOUR_MATCH[series.title]) {\n                COURSE_COLOUR_MATCH[series.title] = parseInt(Math.random() * 0xffffff).toString(16);\n            }\n            let seriesData = getSeriesPlaceholder();\n            seriesData.label = series.title;\n            seriesData.values = series.values;\n            seriesData.colors = ['#' + COURSE_COLOUR_MATCH[series.title]];\n            data.series.push(seriesData);\n        });\n        data.labels = response.xlabels;\n        data.axes.y[0].max = 100;\n        data.axes.y[0].stepSize = 20;\n        let yLabels = {};\n        response.ylabels.forEach((element) => {\n            yLabels[element.value] = element.label;\n        });\n        data.axes.y[0].labels = yLabels;\n        return data;\n    }).catch(() => {\n        displayError(\"API Error\");\n    });\n\n    engagementData.then((data) => {\n        if (data === null) {\n            return;\n        }\n        let chartArea = document.querySelector('#chart-area-engagement');\n        let chartImage = chartArea.querySelector('.chart-image');\n        chartImage.innerHTML = \"\";\n        ChartBuilder.make(data).then((chart) => {\n            new ChartJSOutput(chartImage, chart);\n            return;\n        }).catch();\n        return;\n    }).catch();\n};\n\nconst getSeriesPlaceholder = () => {\n    return {\n        \"label\": \"\",\n        \"labels\": null,\n        \"type\": null,\n        \"values\": [],\n        \"colors\": [],\n        \"fill\": null,\n        \"axes\": {\n            \"x\": null,\n            \"y\": null\n        },\n        \"urls\": [],\n        \"smooth\": null\n    };\n};\n\nconst getGraphDataPlaceholder = () => {\n    return {\n        \"type\": \"line\",\n        \"series\": [],\n        \"labels\": [],\n        \"title\": \"Course Engagement\",\n        \"axes\": {\n            \"x\": [],\n            \"y\": [\n                {\n                    \"label\": null,\n                    \"labels\": {},\n                    \"max\": 100,\n                    \"min\": 0,\n                    \"position\": null,\n                    \"stepSize\": null\n                }\n            ]\n        },\n        \"legend_options\": {\n            \"display\": true\n        },\n        \"config_colorset\": null,\n        \"smooth\": true\n    };\n};\n\n/**\n * Display an error on the page, which replaces the engagement graphs on the page.\n *\n * @param {string} langString Text displayed on the page\n */\nconst displayError = (langString) => {\n    let chartArea = document.querySelector('#chart-area-engagement');\n    let chartImage = chartArea.querySelector('.chart-image');\n    chartImage.innerHTML = langString;\n};\n\n/**\n * Get teacher course analytics data\n *\n * @param {Number|null} start Start time of analytics period in seconds\n * @param {Number|null} end End of analytics period in seconds\n * @returns {Promise}\n */\nconst getTeacherCourseEngagementData = (start, end) => {\n    return Ajax.call([{\n        methodname: 'local_ace_get_teacher_course_analytics_graph',\n        args: {\n            'start': start,\n            'end': end\n        },\n    }])[0];\n};\n"],"file":"teacher_course_engagement.min.js"}