{"version":3,"file":"bulk_email.min.js","sources":["../src/bulk_email.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Bulk email all students selected on the table\n *\n * @module      local_ace/bulk_emails\n * @copyright   2021 University of Canterbury\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalFactory from 'core/modal_factory';\nimport Templates from 'core/templates';\nimport ModalEvents from \"core/modal_events\";\nimport * as Str from 'core/str';\nimport Ajax from 'core/ajax';\nimport * as Toast from 'core/toast';\nimport Notification from 'core/notification';\n\nexport const init = () => {\n    let strings = [\n        {\n            key: 'emailsend',\n            component: 'local_ace'\n        },\n        {\n            key: 'bulkemailselected',\n            component: 'local_ace',\n        }\n    ];\n\n    let emailSend = '';\n    Str.get_strings(strings).then(function(langStrings) {\n        emailSend = langStrings[0];\n        let emailSelected = langStrings[1];\n        let templatePromise = Templates.render('local_ace/bulk_email_selected', {});\n\n        return ModalFactory.create({\n            title: emailSelected,\n            body: templatePromise,\n            type: ModalFactory.types.SAVE_CANCEL,\n        });\n    }).done(function(modal) {\n        modal.getRoot()[0].classList.add('local_ace-slim-modal');\n        modal.setSaveButtonText(emailSend);\n        modal.getRoot().on(ModalEvents.save, function() {\n            let userids = [];\n            let selectedRows = document.querySelectorAll('input[name=\"reportbuilder-select\"]:checked');\n\n            selectedRows.forEach((checkbox) => {\n                userids.push(parseInt(checkbox.dataset.id));\n            });\n\n            let subject = document.querySelector('#local_ace-email-subject').value;\n            let body = document.querySelector('#local_ace-email-body').value;\n\n            sendBulkEmails(userids, subject, body).then(response => {\n               Toast.add(response.message ?? 'An error occurred', {});\n            });\n        });\n\n        // Handle hidden event.\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            // Destroy when hidden.\n            modal.destroy();\n        });\n\n        // Show the modal.\n        modal.show();\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Send bulk email to a list of users.\n *\n * @param {Array[]} userids\n * @param {String} subject\n * @param {String} body\n * @return {Promise}\n */\nconst sendBulkEmails = (userids, subject, body) => {\n    return Ajax.call([{\n        methodname: 'local_ace_send_bulk_emails',\n        args: {\n            'userids': userids,\n            'subject': subject,\n            'body': body\n        },\n    }])[0];\n};\n"],"names":["emailSend","Str","get_strings","key","component","then","langStrings","emailSelected","templatePromise","Templates","render","ModalFactory","create","title","body","type","types","SAVE_CANCEL","done","modal","getRoot","classList","add","setSaveButtonText","on","ModalEvents","save","userids","document","querySelectorAll","forEach","checkbox","push","parseInt","dataset","id","subject","querySelector","value","sendBulkEmails","response","Toast","message","hidden","destroy","show","catch","Notification","exception","Ajax","call","methodname","args"],"mappings":";;;;;;;sZA+BoB,SAYZA,UAAY,GAChBC,IAAIC,YAZU,CACV,CACIC,IAAK,YACLC,UAAW,aAEf,CACID,IAAK,oBACLC,UAAW,eAKMC,MAAK,SAASC,aACnCN,UAAYM,YAAY,OACpBC,cAAgBD,YAAY,GAC5BE,gBAAkBC,mBAAUC,OAAO,gCAAiC,WAEjEC,uBAAaC,OAAO,CACvBC,MAAON,cACPO,KAAMN,gBACNO,KAAMJ,uBAAaK,MAAMC,iBAE9BC,MAAK,SAASC,OACbA,MAAMC,UAAU,GAAGC,UAAUC,IAAI,wBACjCH,MAAMI,kBAAkBvB,WACxBmB,MAAMC,UAAUI,GAAGC,sBAAYC,MAAM,eAC7BC,QAAU,GACKC,SAASC,iBAAiB,8CAEhCC,SAASC,WAClBJ,QAAQK,KAAKC,SAASF,SAASG,QAAQC,YAGvCC,QAAUR,SAASS,cAAc,4BAA4BC,MAC7DxB,KAAOc,SAASS,cAAc,yBAAyBC,MAE3DC,eAAeZ,QAASS,QAAStB,MAAMT,MAAKmC,iCACzCC,MAAMnB,8BAAIkB,SAASE,uDAAW,oBAAqB,UAK1DvB,MAAMC,UAAUI,GAAGC,sBAAYkB,QAAQ,WAEnCxB,MAAMyB,aAIVzB,MAAM0B,UAEPC,MAAMC,sBAAaC,kBAWpBT,eAAiB,CAACZ,QAASS,QAAStB,OAC/BmC,cAAKC,KAAK,CAAC,CACdC,WAAY,6BACZC,KAAM,SACSzB,gBACAS,aACHtB,SAEZ"}