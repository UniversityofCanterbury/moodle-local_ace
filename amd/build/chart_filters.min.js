define("local_ace/chart_filters",["exports","local_ace/litepicker","core/notification","core/ajax"],(function(_exports,_litepicker,_notification,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Provides the chart filters for engagement graphs
   *
   * @module      local_ace/chart_filters
   * @copyright   2021 University of Canterbury
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_litepicker=_interopRequireDefault(_litepicker),_notification=_interopRequireDefault(_notification),_ajax=_interopRequireDefault(_ajax);const Selectors_chartFilterOptions="#chart-filter-options",Selectors_courseToDate="#course-to-date",Selectors_last12Days="#last-12-days",Selectors_dateRange="#date-range";let updateFunc=null;_exports.init=function(providedFunc){let providedDefaultFilter=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;updateFunc=providedFunc;let filter=getActiveFilter();null===filter&&(null!==providedDefaultFilter?(getFilterNodes().forEach((element=>{element.id===providedDefaultFilter&&("last-12-days"===element.id?set12DaysFilter():"course-to-date"===element.id&&setCourseToDateFilter())})),null===getActiveFilter()&&setCourseToDateFilter()):getChartFilterPreference().then((response=>{response.error||null!==response.preferences[0].value&&getFilterNodes().forEach((element=>{element.id===response.preferences[0].value&&("last-12-days"===element.id?set12DaysFilter():"course-to-date"===element.id&&setCourseToDateFilter())}))})).then((()=>{null===getActiveFilter()&&setCourseToDateFilter()}))),setupFilters()};const setCourseToDateFilter=()=>{let filter=document.querySelector(Selectors_courseToDate);setActiveFilter(filter),updateFunc(null,null)},set12DaysFilter=()=>{let filter=document.querySelector(Selectors_last12Days);setActiveFilter(filter);let date=new Date;date.setDate(date.getDate()-12);let val=date.getTime()/1e3;updateFunc(val.toFixed(0),null)},setActiveFilter=suppliedFilter=>{getFilterNodes().forEach((filter=>{filter===suppliedFilter?(filter.dataset.filter="active","date-range"!==filter.id&&updateChartFilterPreference(filter.id)):filter.dataset.filter=null,updateFilterDisplay(filter)}))},setupFilters=()=>{let filtersNode=document.querySelector(Selectors_chartFilterOptions);filtersNode.querySelector(Selectors_courseToDate).addEventListener("click",(()=>{setCourseToDateFilter(),picker.clearSelection()})),filtersNode.querySelector(Selectors_last12Days).addEventListener("click",(()=>{set12DaysFilter(),picker.clearSelection()}));let dateRangeFilter=filtersNode.querySelector(Selectors_dateRange),picker=new _litepicker.default({format:"DD-MM-YYYY",element:dateRangeFilter,singleMode:!1,splitView:!1,setup:picker=>{picker.on("selected",((date1,date2)=>{void 0!==date1&&void 0!==date2&&(setActiveFilter(dateRangeFilter),updateFunc(date1.timestamp()/1e3,date2.timestamp()/1e3))}))}});picker.clearSelection()},updateFilterDisplay=filter=>{"active"===filter.dataset.filter?(filter.classList.add("btn-primary"),filter.classList.remove("btn-secondary")):(filter.classList.add("btn-secondary"),filter.classList.remove("btn-primary"))},getActiveFilter=()=>{let filter=getFilterNodes().find((filter=>"active"===filter.dataset.filter));return void 0!==filter?filter:null},getFilterNodes=()=>{let filtersNode=document.querySelector(Selectors_chartFilterOptions);return[filtersNode.querySelector(Selectors_courseToDate),filtersNode.querySelector(Selectors_last12Days),filtersNode.querySelector(Selectors_dateRange)]},updateChartFilterPreference=function(activeFilter){let request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"local_ace_default_chart_filter",value:activeFilter}]}};_ajax.default.call([request])[0].fail(_notification.default.exception)},getChartFilterPreference=function(){return _ajax.default.call([{methodname:"core_user_get_user_preferences",args:{name:"local_ace_default_chart_filter"}}])[0]}}));

//# sourceMappingURL=chart_filters.min.js.map