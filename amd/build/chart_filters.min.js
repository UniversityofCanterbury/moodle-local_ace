define ("local_ace/chart_filters",["exports","local_ace/litepicker","core/ajax"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=d(b);c=d(c);function d(a){return a&&a.__esModule?a:{default:a}}var e={chartFilterOptions:"#chart-filter-options",courseToDate:"#course-to-date",last12Days:"#last-12-days",dateRange:"#date-range"},f=null;a.init=function init(a){f=a;var b=l();if(null===b){o().then(function(a){if(a.error){return}if(null!==a.preferences[0].value){m().forEach(function(b){if(b.id===a.preferences[0].value){if("last-12-days"===b.id){h()}else if("course-to-date"===b.id){g()}}})}}).then(function(){if(null===l()){g()}})}j()};var g=function(){var a=document.querySelector(e.courseToDate);i(a);f(null,null)},h=function(){var a=document.querySelector(e.last12Days);i(a);var b=new Date;b.setDate(b.getDate()-12);var c=b.getTime()/1e3;f(c.toFixed(0),null)},i=function(a){m().forEach(function(b){if(b===a){b.dataset.filter="active";if("date-range"!==b.id){n(b.id)}}else{b.dataset.filter=null}k(b)})},j=function(){var a=document.querySelector(e.chartFilterOptions),c=a.querySelector(e.courseToDate);c.addEventListener("click",function(){g();k.clearSelection()});var d=a.querySelector(e.last12Days);d.addEventListener("click",function(){h();k.clearSelection()});var j=a.querySelector(e.dateRange),k=new b.default({format:"DD-MM-YYYY",element:j,singleMode:!1,splitView:!1,setup:function setup(a){a.on("selected",function(a,b){if(a===void 0||b===void 0){return}i(j);f(a.timestamp()/1e3,b.timestamp()/1e3)})}});k.clearSelection()},k=function(a){if(a.dataset.filter==="active"){a.classList.add("btn-primary");a.classList.remove("btn-secondary")}else{a.classList.add("btn-secondary");a.classList.remove("btn-primary")}},l=function(){var a=m(),b=a.find(function(a){return a.dataset.filter==="active"});if(b!==void 0){return b}return null},m=function(){var a=document.querySelector(e.chartFilterOptions);return[a.querySelector(e.courseToDate),a.querySelector(e.last12Days),a.querySelector(e.dateRange)]},n=function(a){c.default.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:"local_ace_default_chart_filter",value:a}]}}])[0].fail(Notification.exception)},o=function(){return c.default.call([{methodname:"core_user_get_user_preferences",args:{name:"local_ace_default_chart_filter"}}])[0]}});
//# sourceMappingURL=chart_filters.min.js.map
