define("local_ace/activity_engagement",["exports","core/ajax","core/chart_builder","core/chart_output_chartjs","local_ace/chart_filters"],(function(_exports,_ajax,_chart_builder,_chart_output_chartjs,_chart_filters){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Shows the activity engagement graph
   *
   * @module      local_ace/activity_engagement
   * @copyright   2021 University of Canterbury
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_chart_builder=_interopRequireDefault(_chart_builder),_chart_output_chartjs=_interopRequireDefault(_chart_output_chartjs);let CMID=0,CUMULATIVE=!1,START_TIME=null,END_TIME=null,COLOUR_ACTIVITY_ENGAGEMENT=null;_exports.init=parameters=>{0===CMID&&(COLOUR_ACTIVITY_ENGAGEMENT=parameters.colouractivityengagement,CMID=parameters.cmid,(0,_chart_filters.init)(updateGraph),document.querySelector("#show-cumulative").addEventListener("click",showCumulativeGraph),document.querySelector("#show-daily-access").addEventListener("click",showDaily))};const showCumulativeGraph=()=>{CUMULATIVE=!0,updateGraph(),document.querySelector("#show-cumulative").style.display="none",document.querySelector("#show-daily-access").style.display=null},showDaily=()=>{CUMULATIVE=!1,updateGraph(),document.querySelector("#show-cumulative").style.display=null,document.querySelector("#show-daily-access").style.display="none"},displayError=langString=>{document.querySelector("#chart-area-engagement").querySelector(".chart-image").innerHTML=langString},updateGraph=function(){let startDatetime=arguments.length>0&&void 0!==arguments[0]?arguments[0]:START_TIME,endDateTime=arguments.length>1&&void 0!==arguments[1]?arguments[1]:END_TIME;START_TIME!==startDatetime&&(START_TIME=startDatetime),END_TIME!==endDateTime&&(END_TIME=endDateTime);let engagementData=getActivityEngagementData(startDatetime,endDateTime).then((response=>{if(null!==response.error||0===response.series.length)return displayError(response.error),null;let data=getGraphDataPlaceholder();data.series[0].values=response.series,data.labels=response.xlabels,data.axes.y[0].max=response.max,data.axes.y[0].stepSize=response.stepsize;let yLabels={};return response.ylabels.forEach((element=>{yLabels[element.value]=element.label})),data.axes.y[0].labels=yLabels,data})).catch((()=>{displayError("API Error")}));engagementData.then((data=>{if(null===data)return;let chartImage=document.querySelector("#chart-area-engagement").querySelector(".chart-image");chartImage.innerHTML="",_chart_builder.default.make(data).then((chart=>{new _chart_output_chartjs.default(chartImage,chart)})).catch()})).catch()},getGraphDataPlaceholder=()=>({type:"line",series:[{label:"Activity Engagement",labels:null,type:null,values:null,colors:[COLOUR_ACTIVITY_ENGAGEMENT],fill:null,axes:{x:null,y:null},urls:[],smooth:null}],labels:null,title:null,axes:{x:[],y:[{label:null,labels:{},max:null,min:0,position:null,stepSize:null}]},legend_options:{display:!1},config_colorset:null,smooth:!0}),getActivityEngagementData=(start,end)=>_ajax.default.call([{methodname:"local_ace_get_activity_analytics_graph",args:{cmid:CMID,start:start,end:end,cumulative:CUMULATIVE}}])[0]}));

//# sourceMappingURL=activity_engagement.min.js.map