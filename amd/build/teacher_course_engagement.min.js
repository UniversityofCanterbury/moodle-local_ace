define ("local_ace/teacher_course_engagement",["exports","core/ajax","core/chart_builder","core/chart_output_chartjs","core/notification","core/modal_factory","core/modal_events","core/templates","local_ace/chart_filters"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=j(b);c=j(c);d=j(d);e=j(e);f=j(f);g=j(g);h=j(h);function j(a){return a&&a.__esModule?a:{default:a}}var k=[],l=[],m=[];a.init=function init(a){m=a.colours;(0,i.init)(o);o(null,null);document.querySelector("#course-filter").addEventListener("click",n)};var n=function(){var a=f.default.create({type:f.default.types.SAVE_CANCEL});a.then(function(a){a.getRoot()[0].classList.add("local_ace-slim-modal");a.setTitle("Course filter");var b=h.default.render("local_ace/course_filter_modal",{courses:l});a.setBody(b);a.setSaveButtonText("Filter");a.getRoot().on(g.default.bodyRendered,function(){k.forEach(function(a){var b=document.querySelector("input[id=course-filter-"+a+"]");if(null!==b){b.checked=!1}})});a.getRoot().on(g.default.save,function(){var a=document.querySelectorAll("input[name=\"course-filter-options\"]:not(:checked)");a.forEach(function(a){if(!k.includes(a.value)){k.push(a.value)}});o()});a.getRoot().on(g.default.hidden,function(){a.destroy()});a.show();return a}).fail(e.default.exception)},o=function(a,b){var f=v(a,b).then(function(a){if(null!==a.error||0===a.series.length){u(a.error);return null}var b=q();l=[];var c=0;a.series.forEach(function(a){l.push({shortname:a.label});var d=p();d.label=a.label;d.values=a.values;d.colors=[m[c%m.length]];c++;b.series.push(d)});b.labels=a.xlabels;b.axes.y[0].max=100;b.axes.y[0].stepSize=25;var d={};a.ylabels.forEach(function(a){d[a.value]=a.label});b.axes.y[0].labels=d;if(8<a.series.length){document.querySelector("#course-filter-wrap").style.display=null}return b}).catch(function(){u("API Error")});f.then(function(a){if(null===a){return}var b=document.querySelector("#chart-area-engagement"),f=b.querySelector(".chart-image");f.innerHTML="";c.default.make(a).then(function(a){var b=new d.default(f,a);t().then(function(a){if(a.error){return}var c=a.preferences[0].value;if(null===c){return}k.push(c.split(","));var d=b._chartjs;for(var e in d.data.datasets){var f=d.data.datasets[e];if(k.includes(f.label)){f.hidden=!0}}d.update()}).fail(e.default.exception)}).catch()}).catch()},p=function(){return{label:"",labels:null,type:null,values:[],colors:[],fill:null,axes:{x:null,y:null},urls:[],smooth:null}},q=function(){return{type:"line",series:[],labels:[],title:"Course Engagement",axes:{x:[],y:[{label:null,labels:{},max:100,min:0,position:null,stepSize:null}]},legend_options:{display:!0,position:"right",onClick:r},config_colorset:null,smooth:!0}},r=function(a,b){var c=b.datasetIndex,d=this.chart,e=d.getDatasetMeta(c);if(null===e.hidden){if(d.data.datasets[c].hidden){k=k.filter(function(a){return a!==d.data.datasets[c].label});s();d.data.datasets[c].hidden=!1}else{k.push(d.data.datasets[c].label);s();d.data.datasets[c].hidden=!0}}d.update()},s=function(){var a={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"local_ace_teacher_hidden_courses",value:k.join(",")}]}};b.default.call([a])[0].fail(e.default.exception)},t=function(){return b.default.call([{methodname:"core_user_get_user_preferences",args:{name:"local_ace_teacher_hidden_courses"}}])[0]},u=function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML=a},v=function(a,c){return b.default.call([{methodname:"local_ace_get_teacher_course_analytics_graph",args:{start:a,end:c}}])[0]}});
//# sourceMappingURL=teacher_course_engagement.min.js.map
