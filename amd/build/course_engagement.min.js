define("local_ace/course_engagement",["exports","core/ajax","core/chart_builder","core/chart_output_chartjs","local_ace/chart_filters"],(function(_exports,_ajax,_chart_builder,_chart_output_chartjs,_chart_filters){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Shows the course engagement graph
   *
   * @module      local_ace/course_engagement
   * @copyright   2021 University of Canterbury
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_chart_builder=_interopRequireDefault(_chart_builder),_chart_output_chartjs=_interopRequireDefault(_chart_output_chartjs);let COURSE_ID=0,START_TIME=null,END_TIME=null;_exports.init=parameters=>{0===COURSE_ID&&(COURSE_ID=parameters.courseid,(0,_chart_filters.init)(updateGraph),document.addEventListener("local_ace-graph-reload",(()=>{updateGraph(START_TIME,END_TIME)}),!1))};const displayError=langString=>{document.querySelector("#chart-area-engagement").querySelector(".chart-image").innerHTML=langString},updateGraph=(startDatetime,endDateTime)=>{START_TIME!==startDatetime&&(START_TIME=startDatetime),END_TIME!==endDateTime&&(END_TIME=endDateTime),getCourseEngagementData(null,startDatetime,endDateTime).then((response=>{if(null!==response.error||0===response.series.length)return displayError(response.error),null;let data=getGraphDataPlaceholder(),legendContainer=document.getElementById("local_ace-graph-series-legend");legendContainer.innerHTML="",response.series.forEach((series=>{let seriesData={label:series.label,labels:null,type:null,values:series.values,colors:[series.colour],fill:null,axes:{x:null,y:null},urls:[],smooth:null};data.series.push(seriesData);let legendBox=document.createElement("span");legendBox.className="legendbox",legendBox.style.cssText="background-color: "+series.colour,legendContainer.appendChild(legendBox);let legendText=document.createElement("span");legendText.className="legendtext",legendText.innerText=series.legend,legendContainer.appendChild(legendText)})),data.labels=response.xlabels,data.axes.y[0].max=100,data.axes.y[0].stepSize=25;let yLabels={};return response.ylabels.forEach((element=>{yLabels[element.value]=element.label})),data.axes.y[0].labels=yLabels,data})).catch((()=>{displayError("API Error")})).then((data=>{if(null===data)return;let chartImage=document.querySelector("#chart-area-engagement").querySelector(".chart-image");chartImage.innerHTML="",_chart_builder.default.make(data).then((chart=>{new _chart_output_chartjs.default(chartImage,chart)})).catch()})).catch()},getGraphDataPlaceholder=()=>({type:"line",series:[],labels:null,title:null,axes:{x:[],y:[{label:null,labels:{},max:null,min:0,position:null,stepSize:null}]},legend_options:{display:!1},config_colorset:null,smooth:!0}),getCourseEngagementData=(period,start,end)=>_ajax.default.call([{methodname:"local_ace_get_course_analytics_graph",args:{courseid:COURSE_ID,period:period,start:start,end:end}}])[0]}));

//# sourceMappingURL=course_engagement.min.js.map